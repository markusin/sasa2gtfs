DROP TABLE @MAPPING_TABLE@;
CREATE TABLE @MAPPING_TABLE@ AS (
SELECT 
  DIST AS DISTANCE_TO_LINE, SDO_LRS.GET_MEASURE(POINT) START_OFFSET, 
  ID AS PED_LINK_ID, STOP_ID AS BUS_NODE_ID
  FROM (
   SELECT 
    SDO_NN_DISTANCE(1) DIST, SDO_LRS.PROJECT_PT(SDO_LRS.CONVERT_TO_LRS_GEOM(E.GEOMETRY), N.GEOMETRY) POINT,
    E.ID, E.SOURCE, E.TARGET, N.STOP_ID
    FROM @BUS_STOPS@ N, @PED_LINKS@ E
   WHERE 
    SDO_NN(E.GEOMETRY,N.GEOMETRY,'SDO_NUM_RES=1', 1 )='TRUE' 
  ) 
  WHERE DIST < @DISTANCE_TOLERANCE@
);
QUIT
