-- create mapping table
DROP TABLE @MAPPING_TABLE@;
CREATE TABLE @MAPPING_TABLE@ AS (
SELECT 
  DIST AS DISTANCE_TO_LINE, SDO_LRS.GET_MEASURE(POINT) START_OFFSET, 
  ID AS EDGE_ID, STOP_ID
  FROM (
   SELECT 
    SDO_NN_DISTANCE(1) DIST, 
    SDO_LRS.PROJECT_PT(SDO_LRS.CONVERT_TO_LRS_GEOM(E.GEOMETRY), S.GEOMETRY) POINT,
    E.ID, E.SOURCE, E.TARGET, S.STOP_ID
    FROM @STOP_TABLE@ S, @EDGE_TABLE@ E
   WHERE 
    SDO_NN(E.GEOMETRY,S.GEOMETRY,'SDO_NUM_RES=1', 1 )='TRUE' 
  ) 
  WHERE DIST <= @THRESHOLD@
);